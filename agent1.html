<!DOCTYPE html>
<html lang="vi" class="h-full bg-gray-100">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Agent Sales Workflow Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        /* L·ªõp CSS cho input n·ªïi b·∫≠t khi focus */
        .highlight-input {
            @apply mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm transition duration-150 ease-in-out;
            @apply focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-blue-500 focus:border-blue-500;
        }
        /* L·ªõp CSS cho log */
        .log-entry { margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px solid #4b5563; }
        .log-entry p { margin: 0; }
        .log-entry .pass { color: #22c55e; } /* Xanh l√° c√¢y s√°ng */
        .log-entry .fail { color: #ef4444; } /* ƒê·ªè s√°ng */
        .log-entry .info { color: #3b82f6; } /* Xanh d∆∞∆°ng s√°ng */
        /* Animation cho th√¥ng b√°o */
        .notification { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="h-full flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-5xl w-full space-y-8"> <!-- TƒÉng ƒë·ªô r·ªông t·ªëi ƒëa -->
        <h1 class="text-3xl font-bold text-center text-gray-900">Gi·∫£ l·∫≠p B√°o c√°o Ho·∫°t ƒë·ªông (AI-Powered)</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- C·ªòT 1: FORM NH·∫¨P LI·ªÜU -->
            <div class="bg-white p-8 shadow-xl rounded-lg border border-gray-200">
                <form id="requestForm" class="space-y-6">
                    <!-- Th√¥ng tin ƒë·ªÅ xu·∫•t -->
                    <fieldset>
                        <legend class="text-lg font-medium text-gray-900">1. Th√¥ng tin ƒê·ªÅ xu·∫•t</legend>
                        <div class="space-y-3 mt-2">
                            <div>
                                <label for="requestName" class="block text-sm font-medium text-gray-700">T√™n ho·∫°t ƒë·ªông</label>
                                <input type="text" style="width: 100%;" id="requestName" value="H·ªôi th·∫£o kh√°ch h√†ng TPHCM T12/2026" class="highlight-input">
                                <!-- AI Co-pilot Suggestion Box -->
                                <div id="aiSuggestion" class="mt-2 space-y-2"></div>
                            </div>
                            <div>
                                <label for="guestCount" class="block text-sm font-medium text-gray-700">S·ªë l∆∞·ª£ng kh√°ch d·ª± ki·∫øn</label>
                                <input type="number" id="guestCount" value="100" class="highlight-input" title="AI s·∫Ω d√πng s·ªë n√†y ƒë·ªÉ chia chi ph√≠ qu√† t·∫∑ng">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">T·ªïng ng√¢n s√°ch xin (T·ª± ƒë·ªông)</label>
                                <input type="text" id="totalBudget" value="80,000,000" readonly class="mt-1 block w-full px-3 py-2 border-gray-300 rounded-md bg-gray-100 cursor-not-allowed">
                            </div>
                        </div>
                    </fieldset>

                    <!-- Chi ti·∫øt H·∫°ng m·ª•c -->
                    <fieldset class="border-t pt-4">
                        <legend class="text-lg font-medium text-gray-900">2. Chi ti·∫øt H·∫°ng m·ª•c (Budget_Item)</legend>
                        
                        <!-- List container -->
                        <div id="budgetItemsList" class="space-y-2 mt-2">
                            <!-- C√°c h·∫°ng m·ª•c ƒë·ªông s·∫Ω ƒë∆∞·ª£c render ·ªü ƒë√¢y -->
                        </div>
                        
                        <!-- Form to add new item -->
                        <div class="mt-4 pt-4 border-t space-y-2">
                            <h4 class="font-medium text-gray-700">Th√™m h·∫°ng m·ª•c m·ªõi</h4>
                            <div class="flex flex-col sm:flex-row gap-2">
                                <input type="text" id="newItemName" placeholder="T√™n h·∫°ng m·ª•c (vd: Qu√† t·∫∑ng)" class="highlight-input flex-grow">
                                <input type="number" id="newItemAmount" placeholder="S·ªë ti·ªÅn" class="highlight-input sm:w-1/3">
                            </div>
                            <button type="button" id="addItemBtn" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                + Th√™m h·∫°ng m·ª•c
                            </button>
                            <div id="addItemError" class="text-sm text-red-600 text-center h-4"></div>
                        </div>
                    </fieldset>
                    
                    <!-- N√∫t h√†nh ƒë·ªông -->
                    <div class="border-t pt-4">
                        <button type="button" id="submitBtn" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-lg font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                            G·ª≠i duy·ªát (AI Agent s·∫Ω ki·ªÉm tra)
                        </button>
                    </div>
                </form>
            </div>

            <!-- C·ªòT 2: B·∫¢NG ƒêI·ªÄU KHI·ªÇN C·ª¶A AI -->
            <div class="bg-gray-800 text-white p-8 shadow-xl rounded-lg border border-gray-700">
                <h2 class="text-xl font-semibold mb-4 text-yellow-400">Nh·∫≠t k√Ω AI "Gatekeeper"</h2>
                <div id="logPanel" class="h-64 overflow-y-auto bg-gray-900 p-4 rounded-md font-mono text-sm space-y-2">
                    <p class="text-gray-400">ƒêang ch·ªù t√≠n hi·ªáu...</p>
                </div>
                
                <h2 class="text-xl font-semibold mt-6 mb-4 text-cyan-400">Th√¥ng b√°o cho Ng∆∞·ªùi d√πng</h2>
                <div id="notificationPanel" class="h-48 bg-gray-900 p-4 rounded-md space-y-3">
                    <p class="text-gray-400">Ch∆∞a c√≥ th√¥ng b√°o...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- GI·∫¢ L·∫¨P DATABASE ---
        
        // B·∫£ng Annual_Budget (V√≠ t·ªïng)
        const annualBudgetDB = {
            '5': { 
                category: "H·ªôi th·∫£o kh√°ch h√†ng",
                amountRemaining: 200000000 // C√≤n 200 tri·ªáu
            }
        };
        
        // B·∫£ng Policy_Rule (Quy ƒë·ªãnh)
        const policyRuleDB = {
            "dinh_muc_qua_tang": 300000, // 300.000 VNƒê
            "hang_muc_cam": ["r∆∞·ª£u", "bia", "thu·ªëc l√°"] // H·∫°ng m·ª•c c·∫•m (lowercase)
        };

        // B·∫£ng l·ªãch s·ª≠ (Cho AI Co-pilot)
        const pastRequestsDB = [
            { name: "H·ªôi th·∫£o H√† N·ªôi 2025", budget: 110000000, category: "h·ªôi th·∫£o", status: "Approved", comment: null },
            { name: "Event ƒê√† N·∫µng", budget: 90000000, category: "h·ªôi th·∫£o", status: "Approved", comment: null },
            { name: "H·ªôi th·∫£o TPHCM Q1 2025", budget: 150000000, category: "h·ªôi th·∫£o", status: "Rejected", comment: "Chi ph√≠ qu√† t·∫∑ng v∆∞·ª£t ƒë·ªãnh m·ª©c." },
            { name: "Tri √¢n kh√°ch h√†ng VIP", budget: 150000000, category: "tri √¢n", status: "Approved", comment: null },
            { name: "H·ªôi th·∫£o C·∫ßn Th∆°", budget: 70000000, category: "h·ªôi th·∫£o", status: "Rejected", comment: "Thi·∫øu b√°o gi√° ƒë·ªãa ƒëi·ªÉm." }
        ];

        // --- D·ªÆ LI·ªÜU ƒê·ªòNG CHO BUDGET ITEMS ---
        let budgetItemsData = [
            { id: 1, name: "Thu√™ h·ªôi tr∆∞·ªùng", amount: 30000000, editable: false },
            { id: 2, name: "Tea-break", amount: 15000000, editable: false },
            { id: 3, name: "Qu√† t·∫∑ng", amount: 35000000, editable: true } // D·ªØ li·ªáu sai ban ƒë·∫ßu
        ];
        
        // --- L·∫•y c√°c DOM Elements ---
        const submitBtn = document.getElementById('submitBtn');
        const logPanel = document.getElementById('logPanel');
        const notificationPanel = document.getElementById('notificationPanel');
        const budgetItemsList = document.getElementById('budgetItemsList');
        const addItemBtn = document.getElementById('addItemBtn');
        const newItemName = document.getElementById('newItemName');
        const newItemAmount = document.getElementById('newItemAmount');
        const totalBudgetInput = document.getElementById('totalBudget');
        const addItemError = document.getElementById('addItemError');
        const guestCountInput = document.getElementById('guestCount');
        const requestNameInput = document.getElementById('requestName');
        const aiSuggestion = document.getElementById('aiSuggestion');
        
        let debounceTimer; // Timer cho AI Co-pilot

        // --- C√ÅC H√ÄM QU·∫¢N L√ù H·∫†NG M·ª§C ---

        function calculateTotalBudget() {
            const total = budgetItemsData.reduce((sum, item) => sum + item.amount, 0);
            totalBudgetInput.value = total.toLocaleString('vi-VN');
        }

        function renderBudgetItems() {
            budgetItemsList.innerHTML = ''; // X√≥a list c≈©
            
            budgetItemsData.forEach(item => {
                const itemEl = document.createElement('div');
                itemEl.className = 'flex justify-between items-center p-2 bg-gray-50 rounded-md border';
                
                let amountHTML = '';
                // H·∫°ng m·ª•c c√≥ th·ªÉ s·ª≠a s·ªë ti·ªÅn n·∫øu 'editable' l√† true
                if (item.editable) {
                    amountHTML = `<input type="number" value="${item.amount}" 
                                         data-id="${item.id}" 
                                         class="item-amount-input sm:w-1/3 w-2/5 text-right rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">`;
                } else {
                    amountHTML = `<span class="font-medium text-gray-900">${item.amount.toLocaleString('vi-VN')}</span>`;
                }

                itemEl.innerHTML = `
                    <span class="text-gray-700 text-sm truncate pr-2">${item.name}</span>
                    <div class="flex items-center gap-2">
                        ${amountHTML}
                        <button type"button" data-id="${item.id}" class="delete-item-btn text-red-500 hover:text-red-700 font-bold text-lg" title="X√≥a">&times;</button>
                    </div>
                `;
                budgetItemsList.appendChild(itemEl);
            });

            // G·∫Øn event listener cho c√°c n√∫t/input v·ª´a t·∫°o
            document.querySelectorAll('.delete-item-btn').forEach(btn => {
                btn.addEventListener('click', handleDeleteItem);
            });
            document.querySelectorAll('.item-amount-input').forEach(input => {
                input.addEventListener('input', handleUpdateItemAmount);
            });

            calculateTotalBudget(); // T√≠nh l·∫°i t·ªïng
        }

        function handleDeleteItem(event) {
            const id = parseInt(event.currentTarget.dataset.id);
            budgetItemsData = budgetItemsData.filter(item => item.id !== id);
            renderBudgetItems();
        }

        function handleUpdateItemAmount(event) {
            const id = parseInt(event.currentTarget.dataset.id);
            const newAmount = parseFloat(event.currentTarget.value) || 0;
            const item = budgetItemsData.find(item => item.id === id);
            if (item) {
                item.amount = newAmount;
            }
            calculateTotalBudget();
        }

        function handleAddItem() {
            const name = newItemName.value.trim();
            const amount = parseFloat(newItemAmount.value) || 0;
            addItemError.textContent = ''; // X√≥a l·ªói c≈©
            
            if (!name || amount === 0) {
                addItemError.textContent = "Vui l√≤ng nh·∫≠p t√™n v√† s·ªë ti·ªÅn h·ª£p l·ªá.";
                return;
            }
            
            const newId = (budgetItemsData.length > 0 ? Math.max(...budgetItemsData.map(i => i.id)) : 0) + 1;
            
            budgetItemsData.push({
                id: newId,
                name: name,
                amount: amount,
                // T·ª± ƒë·ªông cho ph√©p s·ª≠a n·∫øu t√™n ch·ª©a "Qu√† t·∫∑ng"
                editable: name.toLowerCase().includes("qu√†")
            });
            
            newItemName.value = '';
            newItemAmount.value = '';
            renderBudgetItems();
        }

        // --- H√ÄM AI CO-PILOT ---

        function runAICopilot() {
            const query = requestNameInput.value.toLowerCase();
            aiSuggestion.innerHTML = ''; // X√≥a g·ª£i √Ω c≈©

            if (query.includes("h·ªôi th·∫£o")) {
                let suggestionHTML = '';
                
                // 1. G·ª£i √Ω ng√¢n s√°ch (t·ª´ c√°c ca 'Approved')
                const approvedEvents = pastRequestsDB.filter(e => e.category === "h·ªôi th·∫£o" && e.status === "Approved");
                if (approvedEvents.length > 0) {
                    const avgBudget = approvedEvents.reduce((sum, e) => sum + e.budget, 0) / approvedEvents.length;
                    suggestionHTML += `
                        <div class="notification p-3 bg-blue-50 border border-blue-200 rounded-md">
                            <h4 class="font-bold text-blue-800">üí° G·ª£i √Ω t·ª´ AI Co-pilot:</h4>
                            <p class="text-sm text-blue-700">C√°c "H·ªôi th·∫£o" t∆∞∆°ng t·ª± (ƒë√£ duy·ªát) c√≥ ng√¢n s√°ch trung b√¨nh l√† ${avgBudget.toLocaleString('vi-VN')}ƒë.</p>
                        </div>
                    `;
                }

                // 2. C·∫£nh b√°o (t·ª´ c√°c ca 'Rejected')
                const rejectedEvents = pastRequestsDB.filter(e => e.category === "h·ªôi th·∫£o" && e.status === "Rejected");
                if (rejectedEvents.length > 0) {
                    // L·∫•y l√Ω do t·ª´ ch·ªëi duy nh·∫•t
                    const uniqueReasons = [...new Set(rejectedEvents.map(e => e.comment))];
                    let reasonsHTML = uniqueReasons.map(reason => `<li class="text-sm text-yellow-800">- ${reason}</li>`).join('');

                    suggestionHTML += `
                        <div class="notification p-3 bg-yellow-50 border border-yellow-200 rounded-md mt-2">
                            <h4 class="font-bold text-yellow-900">‚ö†Ô∏è C·∫£nh b√°o t·ª´ AI (L·ªói th∆∞·ªùng g·∫∑p):</h4>
                            <p class="text-sm text-yellow-800">C√°c "H·ªôi th·∫£o" tr∆∞·ªõc ƒë√¢y th∆∞·ªùng b·ªã qu·∫£n l√Ω t·ª´ ch·ªëi v√¨:</p>
                            <ul class="list-disc list-inside ml-4 mt-1">
                                ${reasonsHTML}
                            </ul>
                        </div>
                    `;
                }
                
                aiSuggestion.innerHTML = suggestionHTML;
            }
        }
        
        // H√†m Debounce
        function debounce(func, delay) {
            return function(...args) {
                clearTimeout(debounceTimer);
                debounceTimer = setTimeout(() => {
                    func.apply(this, args);
                }, delay);
            };
        }

        // --- H√ÄM AI GATEKEEPER ---
        
        function runAIAgent() {
            logPanel.innerHTML = '<p class="text-yellow-400">ƒê√£ nh·∫≠n Request. B·∫Øt ƒë·∫ßu qu√©t...</p>';
            notificationPanel.innerHTML = '';
            
            let errors = [];

            // L·∫•y d·ªØ li·ªáu ƒë·∫ßu v√†o T·ª™ M·∫¢NG D·ªÆ LI·ªÜU
            const totalRequested = budgetItemsData.reduce((sum, item) => sum + item.amount, 0);
            const giftItem = budgetItemsData.find(item => item.name.toLowerCase().includes("qu√†"));
            const numGuests = parseInt(guestCountInput.value) || 1;
            const annualBudgetID = '5'; // ID "v√≠"
            
            // --- KI·ªÇM TRA 1: NG√ÇN S√ÅCH T·ªîNG (Annual_Budget) ---
            let check1_log = `<p>Ki·ªÉm tra 1: Ng√¢n s√°ch t·ªïng (B·∫£ng Annual_Budget)...</p>`;
            const budget = annualBudgetDB[annualBudgetID];
            
            if (totalRequested <= budget.amountRemaining) {
                check1_log += `<p class="pass ml-4">‚úÖ PASS: Ng√¢n s√°ch xin (${totalRequested.toLocaleString('vi-VN')}ƒë) <= Ng√¢n s√°ch c√≤n l·∫°i (${budget.amountRemaining.toLocaleString('vi-VN')}ƒë).</p>`;
            } else {
                check1_log += `<p class="fail ml-4">‚ùå FAIL: Ng√¢n s√°ch xin (${totalRequested.toLocaleString('vi-VN')}ƒë) > Ng√¢n s√°ch c√≤n l·∫°i (${budget.amountRemaining.toLocaleString('vi-VN')}ƒë).</p>`;
                errors.push(`V∆∞·ª£t ng√¢n s√°ch t·ªïng c·ªßa ph√≤ng. (Xin ${totalRequested.toLocaleString('vi-VN')}ƒë, ch·ªâ c√≤n ${budget.amountRemaining.toLocaleString('vi-VN')}ƒë)`);
            }
            logPanel.innerHTML += `<div class="log-entry">${check1_log}</div>`;
            
            // --- KI·ªÇM TRA 2: ƒê·ªäNH M·ª®C CHI TI·∫æT (Policy_Rule) ---
            let check2_log = `<p>Ki·ªÉm tra 2: ƒê·ªãnh m·ª©c qu√† t·∫∑ng (B·∫£ng Policy_Rule)...</p>`;
            const giftPolicy = policyRuleDB.dinh_muc_qua_tang;

            if (giftItem) {
                const giftUnitCost = giftItem.amount / numGuests;
                
                if (giftUnitCost <= giftPolicy) {
                    check2_log += `<p class="pass ml-4">‚úÖ PASS: Chi ph√≠ qu√† t·∫∑ng (${giftUnitCost.toLocaleString('vi-VN')}ƒë/ng∆∞·ªùi) <= ƒê·ªãnh m·ª©c (${giftPolicy.toLocaleString('vi-VN')}ƒë/ng∆∞·ªùi).</p>`;
                } else {
                    check2_log += `<p class="fail ml-4">‚ùå FAIL: Chi ph√≠ qu√† t·∫∑ng (${giftUnitCost.toLocaleString('vi-VN')}ƒë/ng∆∞·ªùi) > ƒê·ªãnh m·ª©c (${giftPolicy.toLocaleString('vi-VN')}ƒë/ng∆∞·ªùi).</p>`;
                    errors.push(`Chi ph√≠ qu√† t·∫∑ng (${giftUnitCost.toLocaleString('vi-VN')}ƒë/ng∆∞·ªùi) v∆∞·ª£t ƒë·ªãnh m·ª©c cho ph√©p (${giftPolicy.toLocaleString('vi-Vn')}ƒë/ng∆∞·ªùi) cho ${numGuests} kh√°ch.`);
                }
            } else {
                check2_log += `<p class="pass ml-4">‚úÖ PASS: Kh√¥ng t√¨m th·∫•y h·∫°ng m·ª•c "Qu√† t·∫∑ng". B·ªè qua ki·ªÉm tra.</p>`;
            }
            logPanel.innerHTML += `<div class="log-entry">${check2_log}</div>`;

            // --- KI·ªÇM TRA 3: H·∫†NG M·ª§C B·ªä C·∫§M (Policy_Rule) ---
            let check3_log = `<p>Ki·ªÉm tra 3: H·∫°ng m·ª•c b·ªã c·∫•m (B·∫£ng Policy_Rule)...</p>`;
            const forbiddenItems = policyRuleDB.hang_muc_cam;
            let forbiddenFound = [];
            
            budgetItemsData.forEach(item => {
                const itemNameLower = item.name.toLowerCase();
                forbiddenItems.forEach(forbidden => {
                    if (itemNameLower.includes(forbidden)) {
                        forbiddenFound.push(item.name);
                    }
                });
            });

            if (forbiddenFound.length === 0) {
                check3_log += `<p class="pass ml-4">‚úÖ PASS: Kh√¥ng ch·ª©a h·∫°ng m·ª•c b·ªã c·∫•m (v√≠ d·ª•: ${forbiddenItems.join(', ')}).</p>`;
            } else {
                check3_log += `<p class="fail ml-4">‚ùå FAIL: Ph√°t hi·ªán h·∫°ng m·ª•c b·ªã c·∫•m: ${forbiddenFound.join(', ')}.</p>`;
                errors.push(`Ph√°t hi·ªán h·∫°ng m·ª•c b·ªã c·∫•m (v√≠ d·ª•: ${forbiddenItems.join(', ')}): ${forbiddenFound.join(', ')}.`);
            }
            logPanel.innerHTML += `<div class="log-entry">${check3_log}</div>`;

            // --- T·ªîNG K·∫æT & G·ª¨I TH√îNG B√ÅO ---
            logPanel.innerHTML += `<div class="log-entry"><p class="text-yellow-400">Ho√†n t·∫•t qu√©t. ƒêang ra quy·∫øt ƒë·ªãnh...</p></div>`;
            
            if (errors.length > 0) {
                // K·ªäCH B·∫¢N FAIL
                logPanel.innerHTML += `<div class="log-entry"><p class="fail font-bold">K·∫æT QU·∫¢: ‚ùå C√ì L·ªñI</p></div>`;
                logPanel.innerHTML += `<div class="log-entry"><p class="info">H√†nh ƒë·ªông: C·∫≠p nh·∫≠t Status = "B·ªã t·ª´ ch·ªëi".</p></div>`;
                logPanel.innerHTML += `<div class="log-entry"><p class="info">H√†nh ƒë·ªông: G·ª≠i th√¥ng b√°o l·ªói cho Nh√¢n vi√™n (Nguy·ªÖn VƒÉn An).</p></div>`;
                showNotification_Sales(errors);
            } else {
                // K·ªäCH B·∫¢N PASS
                logPanel.innerHTML += `<div class="log-entry"><p class="pass font-bold">K·∫æT QU·∫¢: ‚úÖ T·∫§T C·∫¢ ƒê√É PASS</p></div>`;
                logPanel.innerHTML += `<div class="log-entry"><p class="info">H√†nh ƒë·ªông: C·∫≠p nh·∫≠t Status = "Ch·ªù s·∫øp ATO duy·ªát".</p></div>`;
                logPanel.innerHTML += `<div class="log-entry"><p class="info">H√†nh ƒë·ªông: G·ª≠i th√¥ng b√°o t√≥m t·∫Øt cho S·∫øp (Tr·∫ßn Th·ªã B).</p></div>`;
                showNotification_Manager(totalRequested);
            }
        }

        // --- C√ÅC H√ÄM HI·ªÇN TH·ªä TH√îNG B√ÅO ---

        function showNotification_Sales(errors) {
            let errorList = errors.map(e => `<li>- ${e}</li>`).join('');
            notificationPanel.innerHTML = `
                <div class="notification p-4 bg-red-100 border border-red-300 rounded-md">
                    <h3 class="font-medium text-red-800">G·ª≠i Nguy·ªÖn VƒÉn An (Nh√¢n vi√™n)</h3>
                    <p class="text-sm text-red-700 mt-1">ƒê·ªÅ xu·∫•t c·ªßa b·∫°n ƒë√£ b·ªã <strong class="font-bold">h·ªá th·ªëng t·ª± ƒë·ªông t·ª´ ch·ªëi</strong>. Vui l√≤ng s·ª≠a c√°c l·ªói sau v√† g·ª≠i l·∫°i:</p>
                    <ul class="list-disc list-inside text-sm text-red-700 mt-2 space-y-1">
                        ${errorList}
                    </ul>
                </div>`;
        }
        
        function showNotification_Manager(totalAmount) {
            notificationPanel.innerHTML = `
                <div class="notification p-4 bg-blue-100 border border-blue-300 rounded-md">
                    <h3 class="font-medium text-blue-800">G·ª≠i Tr·∫ßn Th·ªã B (Qu·∫£n l√Ω)</h3>
                    <p class="text-sm text-blue-700 mt-1">Nguy·ªÖn VƒÉn An v·ª´a g·ª≠i ƒë·ªÅ xu·∫•t "${requestNameInput.value}" (${totalAmount.toLocaleString('vi-VN')}ƒë).</p>
                    <p class="text-sm text-blue-900 mt-2 italic bg-green-100 p-2 rounded">
                        <strong>Ghi ch√∫ c·ªßa AI:</strong> ƒê·ªÅ xu·∫•t n√†y ƒë√£ ƒë∆∞·ª£c t·ª± ƒë·ªông ki·ªÉm tra, tu√¢n th·ªß ƒë·ªãnh m·ª©c c√¥ng ty v√† n·∫±m trong ng√¢n s√°ch c√≤n l·∫°i.
                    </p>
                    <p class="text-sm text-blue-700 mt-2">Vui l√≤ng xem x√©t v√† ph√™ duy·ªát.</p>
                </div>`;
        }
        
        // --- KH·ªûI T·∫†O KHI T·∫¢I TRANG ---
        document.addEventListener('DOMContentLoaded', () => {
            // G·∫Øn Event Listener cho n√∫t "Th√™m"
            addItemBtn.addEventListener('click', handleAddItem);
            
            // G·∫Øn Event Listener cho n√∫t "G·ª≠i duy·ªát"
            submitBtn.addEventListener('click', runAIAgent);
            
            // G·∫Øn Event Listener cho AI Co-pilot (v·ªõi debounce)
            const debouncedRunAICopilot = debounce(runAICopilot, 300);
            requestNameInput.addEventListener('input', debouncedRunAICopilot);
            
            // Render c√°c h·∫°ng m·ª•c ban ƒë·∫ßu
            renderBudgetItems();

            // T·ª± ƒë·ªông ch·∫°y Co-pilot l·∫ßn ƒë·∫ßu khi t·∫£i trang
            runAICopilot();
        });
    </script>
</body>
</html>